<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9: http://docutils.sourceforge.net/" />
<title>RepastCity Tutorial</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="repastcity-tutorial">
<h1 class="title">RepastCity Tutorial</h1>

<div class="section" id="introduction">
<h1>Introduction</h1>
<p>This tutorial uses the RepastCity model to build a simple agent-based model of a virtual city. In the basic model, agents choose a building to travel to, go there, and then travel home again; repeating this process forever. This tutorial enhance the model to make the behaviour a bit more interesting by turning the agents into criminal bankers (bankers who, in these tough economic times, need to commit burglary to top up their bonuses). We can then explore some interesting city dynamics.</p>
<p>The following changes will be made to the basic model:</p>
<ol class="arabic simple">
<li>Give the agents a 'workplace' - a bank that they can use for their legitimate city jobs.</li>
<li>Implement a clock so that agents know what the time is, not just how many time steps ('iterations') have occurred.</li>
<li>Change the agent's behaviour so that they go to work between 9am - 5pm and spend the rest of their time at home (or travelling).</li>
<li>Further update the agents' behaviour so that they randomly commit burglary if they pass a suitable house while they are travelling.</li>
<li>Remove a few key roads from the road network to see what affect this will have on patterns of burglary.</li>
</ol>
</div>
<div class="section" id="gis-data-york">
<h1>GIS Data - York</h1>
<p>The data for the tutorial cover part of the city of York. For the sake of this tutorial, the data have been cut down by removing some of the houses and roads. The image below illustrates the study area; agents live in the suburban areas towards the west of the city and travel into the centre for work. There are a small number of major roads which offer the quickest routes into the city but, due to budget cuts, the council are going to have to close these and the bankers will have to find new routes. This might lead to interesting effects on travel patterns and on burglary rates.</p>
<p>XXXX image of data.</p>
</div>
<div class="section" id="loading-the-tutorial">
<h1>Loading the Tutorial</h1>
<p>XXXX - where to find the tutorial code and load it into Repast.</p>
<p>XXXX - click on the down arrow to show the different components.</p>
<img alt="figures/run_button.tiff" src="figures/run_button.tiff" />
<p>XXXX - the Simphony GUI</p>
</div>
<div class="section" id="giving-agents-somewhere-to-work">
<h1>Giving Agents Somewhere to Work</h1>
<p>In the basic model, agents are instances of the <tt class="docutils literal">DefaultAgent</tt> class which lives in the <tt class="docutils literal">repastcity3.agent</tt> package. To make the first change to the agents, we need to open this source file:</p>
<ol class="arabic simple">
<li>In the left hand window (the 'Package Explorer'), expand the <em>repastcity3</em> folder so that you can see the contents of the program</li>
<li>Expand the <tt class="docutils literal">repastcity3.agent</tt> package.</li>
<li>Open the <tt class="docutils literal">DefaultAgent.java</tt> class. It is possible to create a new class for our banker agents (called <tt class="docutils literal">Banker</tt> for example) but for now we'll just keep the boring <tt class="docutils literal">DefaultAgent</tt> class name.</li>
<li>Scroll down to find the <tt class="docutils literal">step()</tt> method.</li>
</ol>
<p>Once openning the file, your display should look similar to this:</p>
<img alt="figures/agent_step.jpg" src="figures/agent_step.jpg" />
<p>The task for this stage is to find a bank for the agents to work in and set their <cite>workplace</cite> variable accordingly. The <tt class="docutils literal">ContextManager</tt> class is responsible for creating agents and generally configuring the simulation and it is this class that ensures each agent has a home. We will see how this class works later, but in the meantime we will add some code to the agent's default constructor to set their <tt class="docutils literal">workplace</tt> variable.</p>
<p>Repast Simphony organises objects into collections called <em>Contexts</em>. The model works by reading all buildings in the GIS data and adding them into their own context called <tt class="docutils literal">buildingContext</tt>. So, to find a bank we need to iterate over all buildings in the model until we find a bank, then tell the agent that the building we have just found is where they will work. To do this, find the constructure near the top of the <tt class="docutils literal">DefatultAgent</tt> source file and replace the text that is there already:</p>
<pre class="literal-block">
public DefaultAgent() {
        this.id = uniqueID++;
}
</pre>
<p>with the following:</p>
<pre class="literal-block">
public DefaultAgent() {
        this.id = uniqueID++;
        // Find a building that agents can use as their workplace. First, iterate over all buildings in the model
        for (Building b:ContextManager.buildingContext.getRandomObjects(Building.class, 10000)) {
                // See if the building is a bank (they will have type==2).
                if (b.getType()==2) {
                        this.workplace = b;
                        break; // Have found a bank, stop searching.
                }
        }
}
</pre>
<p>Now, when each agent is generated they will also be assigned a randomly-chosen workplace.</p>
</div>
<div class="section" id="implementing-a-clock">
<h1>Implementing a clock</h1>
<p>At the moment, it is possible to find out how many iterations the model has been running for by using a special Repast method:</p>
<pre class="literal-block">
RunEnvironment.getInstance().getCurrentSchedule().getTickCount();
</pre>
<p>However, we want a way for our agents to know what the real time is, in hours and minutes. To do this we can add some code to the <tt class="docutils literal">ContextManager</tt> class which will maintain a <tt class="docutils literal">realTime</tt> variable. This variable will be <tt class="docutils literal">public</tt> so that other classes can access it and we will also create a method that updates the value of the timer at each iteration. To do this, open the <tt class="docutils literal">ContextManager</tt> source file which is part of the <tt class="docutils literal">repastcity3.main</tt> package. The following code can be added anywhere inside the class, but lets put it at the bottom of the source file (after the <tt class="docutils literal">getAgentGeography()</tt> method but before the very last closing brace):</p>
<pre class="literal-block">
/* A variable to represent the real time in decimal hours (e.g. 14.5 means 2:30pm) and a method, called at every
 * iteration, to update the variable. */
public static double realTime = 0.0;
public static int numberOfDays = 0; // It is also useful to count the number of days.

&#64;ScheduledMethod(start=1, interval=2)
public void updateRealTime() {
        realTime += (1.0/60.0); // Increase the time by one minute (a 60th of an hour)
        if (realTime &gt;= 24.0) { // If it's the end of a day then reset the time
                realTime = 0.0;
                numberOfDays++; // Also increment our day counter
                LOGGER.log(Level.INFO, &quot;Simulating day &quot;+numberOfDays);
        }
}
</pre>
<p>After these changes, the end of your <tt class="docutils literal">ContextManager</tt> class should look something like the image below.</p>
<img alt="figures/timer_code.jpg" src="figures/timer_code.jpg" />
</div>
<div class="section" id="making-the-agents-work">
<h1>Making the Agents Work</h1>
<p>Now that we have a clock it is possible to change the agents' beahviour so that they go to work at 9am and then go home again at 5pm. Open the <tt class="docutils literal">DefaultAgent</tt> class again and find the <tt class="docutils literal">step()</tt> method. This method was scheduled in the <tt class="docutils literal">ContextManager</tt> code to be called at each iteration. (If you choose to look at how this is done in <tt class="docutils literal">ContextManager</tt> you'll notice that the scheduling method is much more complicated than that of our real time counter. This is because the agents are actually run simultaneously in different threads which makes the simulation run much more quickly on multi-core computers).</p>
<p>At the moment, the code in the agents' <tt class="docutils literal">step()</tt> method simply makes the agent travel from home to a randomly chosen building and back again forever. The first thing to do is either delete or comment-out all of the code in the <tt class="docutils literal">DefaultBurglar.step()</tt> method. Then add the following:</p>
<p>XXXX HERE</p>
</div>
<div class="section" id="topping-up-their-bonuses-with-burglary">
<h1>Topping Up their Bonuses with Burglary</h1>
</div>
<div class="section" id="getting-some-results">
<h1>Getting Some Results</h1>
</div>
<div class="section" id="austerity-road-closures">
<h1>Austerity Road Closures</h1>
</div>
<div class="section" id="conclusion">
<h1>Conclusion</h1>
</div>
<div class="section" id="other-useful-repast-features">
<h1>Other Useful Repast Features</h1>
<div class="section" id="automatically-creating-objects-from-shapefiles">
<h2>Automatically Creating Objects from Shapefiles</h2>
<p>XXXX - how ShapefileLoad looks for get/set methods and associated variables in the GIS features.</p>
</div>
</div>
</div>
</body>
</html>
